var height=document.documentElement.clientHeight;var width=document.documentElement.clientWidth;var logo=document.getElementById("logo");function onResize(){height=document.documentElement.clientHeight;width=document.documentElement.clientWidth;}
window.addEventListener('load',onResize);window.addEventListener('resize',onResize);var imgElement=document.getElementById("image");var imgContainer=document.getElementById("bwork");var banner=document.getElementById("banner");var decoration=document.getElementById("imagedecoration");var front=document.getElementById("frontpage");var footerInstruct=document.getElementById("footerinstructions");var footerContent=document.getElementById("footercontent");
window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(f){setTimeout(f,1000/60)};function oneTimeListener(target,type,callback){function oneTimeCallback(e){target.removeEventListener(type,oneTimeCallback);callback(e);}
target.addEventListener(type,oneTimeCallback);}
function loadImage(src){var img=new Image();oneTimeListener(img,'load',function(){img=null;});img.src=src;}
function imageReel(images){for(var i=0;i<images.length;i++){loadImage(imagepath+images[i]);}
return function(num){if(num>=0&&num<images.length){imgElement.src=imagepath+images[num];}}}
function composeTransform(transform,dim,x,stat,unit){var still=stat+unit;var trans=String(x)+unit;return transform+"("+(dim!==0?still+","+trans:trans+","+still)+")";}
var lv=document.getElementById("leftvert");var rv=document.getElementById("rightvert");var th=document.getElementById("tophorz");var bh=document.getElementById("bottomhorz");function resizeFrame(box,solid,fade){var verts=[lv,rv];var hrz=[th,bh];frm=[hrz,verts];for(var i=0;i<2;i++){var dim=(i!==0?height:document.body.clientWidth)/2;for(var j=0;j<2;j++){frm[i][j].style.transform=composeTransform("translate",(i+1)%2,(j*2-1)*box[(i+1)%2],0,"px"); var grads=[frm[i][j].getElementsByClassName("first")[0],frm[i][j].getElementsByClassName("last")[0]];var mid=frm[i][j].getElementsByClassName("mid")[0];var midsize=(box[i]+(dim-box[i])*solid[i])/dim;mid.style.transform=composeTransform("scale",i,midsize,1,"");var gradscale=fade[i]*(dim-box[i])/dim;for(var k=0;k<2;k++){

 var translate=((midsize+(gradscale*.47)-.5)*dim)*(k*2-1);var transform=composeTransform("translate",i,translate,0,"px");transform+=" ";transform+=composeTransform("scale",i,gradscale,1,"");grads[k].style.transform=transform;}}}}
function frameImage(){var cheight=imgElement.clientHeight;var cwidth=imgElement.clientWidth;var dir=(cwidth/cheight>1);var vertOffset=(cheight+(height-cheight)*(dir?.4:.6))*.5;var horzOffset=(cwidth+(width-cwidth)*(dir?.5:.3))*.5;resizeFrame([horzOffset,vertOffset],[.25,.25],[.5,.5]);}
imgElement.addEventListener('load',frameImage);window.addEventListener('resize',frameImage);
var values=[];var last=-1;function decPainter(channel,x){x=Math.max(0,Math.min(1,x));while(values.length<channel+1){values.push(1);}
values[channel]=x;var op=1;for(var i=0;i<values.length;i++){op*=values[i];}
if(op!=last){decoration.style.opacity=op;last=op;}}
function imageMover(x){imgContainer.style.transform="translate3d(0, -"+x*(height+imgElement.clientHeight)+"px, 0)";}
function framePainter(x){lv.style.opacity=x;rv.style.opacity=x;bh.style.opacity=x;th.style.opacity=x;}
var bannerParts=[];bannerParts.push(document.getElementById("header"));bannerParts.push(document.getElementById("headerback"));bannerParts.push(document.getElementById("footer"));bannerParts.push(document.getElementById("footerback"));function bannerPainter(x){for(var i=0;i<bannerParts.length;i++){bannerParts[i].style.opacity=x;}
decPainter(0,x);}
var speed=.0008;var accelDist=.5*.5;var accel=speed*speed/(2*accelDist);var accelTime=Math.sqrt(2*accelDist/accel);var travelDist=.5-accelDist;var constTime=travelDist/speed;var totalTime=2*(constTime+accelTime);function createScrollTracker(numImages){return function(itemNum,x){x=Math.max(0,Math.min(1,x));var frameOpacity=Math.min(1,Math.max(0,frameTracker(x)));var imgPosition=Math.min(1,Math.max(0,imgTracker(x)));return{'imgPosition':imgPosition,'frameOpacity':frameOpacity};}}
function imgTracker(through){var translate;var pos=through*totalTime;if(pos<constTime){translate=pos*speed;}else if(pos<constTime+accelTime){translate=.5-.5*accel*Math.pow(accelTime+constTime-pos,2);}else if(pos<totalTime-constTime){translate=.5+.5*accel*Math.pow(pos-(accelTime+constTime),2);}else{translate=1-(totalTime-pos)*speed;}
return translate;}
function frameTracker(through){var frameOpacity;var pos=through*totalTime;if(pos<constTime){frameOpacity=0;}else if(pos<constTime+accelTime){frameOpacity=(pos-constTime)/accelTime;}else if(pos<totalTime-constTime){frameOpacity=1-((pos-(constTime+accelTime))/accelTime);}else{frameOpacity=0;}
return frameOpacity;}
function createScroller(images){var scrollValues=createScrollTracker(images.length);var setImage=imageReel(images);var curr=-1;var bannervis=true;var lastBannerOpacity=-1;var lastImgPosition=-1;var lastFrameOpacity=-1;return function(itemNum,x,bannerOpacity,suppressFrame){var values=scrollValues(itemNum,x);if(itemNum!=curr){curr=itemNum;setImage(curr%images.length);}
if(bannerOpacity===undefined){bannerOpacity=lastBannerOpacity;}
if(suppressFrame===undefined){suppressFrame=false;}
if(bannerOpacity!==lastBannerOpacity){if(bannerOpacity<=0&&bannervis){banner.style.display='none';bannervis=false;}else if(!bannervis&&bannerOpacity>0){banner.style.display='inline';bannervis=true;}
bannerPainter(bannerOpacity);lastBannerOpacity=bannerOpacity;}
imageMover(values.imgPosition);lastImgPosition=values.imgPosition;var frameOpacity=(bannerOpacity>0?Math.max(0,1-bannerOpacity):values.frameOpacity);if(suppressFrame){frameOpacity=0;}
if(frameOpacity!=lastFrameOpacity){framePainter(frameOpacity);lastFrameOpacity=frameOpacity;}}}
function workPage(page){var scroller=createScroller(page);var footerType=1;var lastDir=null;var bannerUp=true;var currPos=.5;var place=0;var absPlace=0;function slide(dir){return function(cb){var mult=(dir==='up'?-1:1);var speed=.012;var x=0;var moveBannerIn=((place===page.length-1&&dir==='down')||(place===1&&dir==='up'));function s(){x+=speed;currPos+=speed*mult;if(currPos>1){currPos=currPos%1;place++;place=place%page.length;absPlace++;}else if(currPos<0){currPos=(currPos+1)%1;place--;place=(place+page.length)%page.length;absPlace--;}
if(x>=1&&x-speed<1){currPos=.5;scroller(place,currPos,(moveBannerIn?1:0));lastDir=dir;bannerUp=moveBannerIn;cb();}else{scroller(place,currPos,(moveBannerIn?Math.max(0,2*(x-.5)):0),(moveBannerIn&&x>.5));requestAnimationFrame(s);}}
function b(way){return(function rec(){x+=speed*(way?.75:1);if(x>.5){scroller(place,currPos,way?1:0);lastDir=dir;bannerUp=way;cb();}else{scroller(place,currPos,way?x*2:1-x*2);requestAnimationFrame(rec);}});}
if((place===page.length-1&&dir==='down'&&footerType===1&&absPlace>0)||(place===1&&dir==='up'&&footerType===1&&absPlace<0)){footerType=0;footerContent.style.opacity=1;footerInstruct.style.opacity=0;}
var movement;if(dir!==lastDir&&!bannerUp){movement=b(true);}else if(bannerUp){movement=b(false);}else{movement=s;}
requestAnimationFrame(movement);}}
var onSlide=function(e){stageTransition(slide(e.detail))}
function resize(){scroller(place,currPos);}
var decorationMove=function(){decoration.style.top=((height-decoration.clientHeight)/2)+'px';}
var imgpr=.5;var decpr=1;function transition(otherFooterType){return function(x){if(x<=imgpr){imgElement.style.opacity=x/imgpr;}else{imgElement.style.opacity=1;}
if(x>1-decpr){decPainter(1,(x-(1-decpr))/decpr);}else{decPainter(1,0);}
if(otherFooterType!=footerType){if(footerType===1){footerInstruct.style.opacity=x;}else{footerContent.style.opacity=x;}}}}
function start(){scroller(0,.5,1);decorationMove();window.addEventListener('slide',onSlide);window.addEventListener('resize',resize);window.addEventListener('resize',decorationMove);imgElement.addEventListener('load',resize);return footerType;}
function stop(){window.removeEventListener('slide',onSlide);window.removeEventListener('resize',resize);window.removeEventListener('resize',decorationMove);imgElement.removeEventListener('load',resize);return footerType;}
return{'start':start,'stop':stop,'transition':transition,'footerType':footerType};}
function frontPage(){var frontImage=document.getElementById("frontimage");function decorationMove(){var fimgbounds=frontImage.getBoundingClientRect();decoration.style.top=((fimgbounds.top+fimgbounds.bottom-decoration.clientHeight)/2)+'px';}
var tback=document.getElementById("headerback");var bback=document.getElementById("footerback");var frontpr=.5;var decpr=1;function transition(otherFooterType){return function(x){if(x<=frontpr){front.style.opacity=x/frontpr;tback.style.opacity=1-x/frontpr;bback.style.opacity=1-x/frontpr;}else{front.style.opacity=1;tback.style.opacity=0;bback.style.opacity=0;}
if(x>1-decpr){decPainter(1,(x-(1-decpr))/decpr);}else{decPainter(1,0);}
if(otherFooterType!==0){footerContent.style.opacity=x;}}}
function start(){scrollTo(0,0);document.body.style.height=0;decorationMove();window.addEventListener('resize',decorationMove);return 0;}
function stop(){window.removeEventListener('resize',decorationMove);return 0;}
return{'start':start,'stop':stop,'transition':transition,'footerType':0};}
var next=null;function stageTransition(transition){pushTransition(transition);executeTransition(false);}
function pushTransition(transition){var hold=next;next=transition;return hold;}
var running=false;function executeTransition(finished){if(finished){running=false;}
if(!running){var x=pushTransition(null);if(x!==null){running=true;x(function(){executeTransition(true)});}}}
var speedscale=.85;function fade(transition,dir,cb){return(function rec(x){x+=(dir?.015:.04)*(dir?1:-1)*speedscale;transition(x);if((dir&&x<1)||(!dir&&x>0)){requestAnimationFrame(function(){rec(x)});}else{cb();}});}

var oldPage=null;function switchPages(switchTo){return function pg(cb){var newPage=maps[switchTo]();var currFooter;if(oldPage!==null){currFooter=oldPage.stop();}else{currFooter=-1;}
var fadeIn=function(){newPage.start();fade(newPage.transition(currFooter),true,cb)(0);}
if(oldPage!==null){fade(oldPage.transition(newPage.footerType),false,fadeIn)(1);}else{fadeIn();}
oldPage=newPage;}}
var currPage=null;function toPage(page){function pg(cb){if(currPage!==page){if(currPage===null){history.replaceState({'page':page},"",page==='index'?root+'/':root+'/'+page);first=false;}else{history.pushState({'page':page},"",page==='index'?root+'/':root+'/'+page);}
currPage=page;switchPages(page)(cb);}else{cb();}}
stageTransition(pg);}
function backToPage(page){stageTransition(switchPages(page));}
var root='/cb';var imagepath="./links/";var art=["cba1.jpg","cba2.jpg","cba3.jpg","cba4.jpg","cba5.jpg","cba6.jpg","cba7.jpg","cba8.jpg","cba9.jpg","cba10.jpg","cba11.jpg","cba12.jpg"];var photos=["cbp8.jpg","cbp2.jpg","cbp3.jpg","cbp4.jpg","cbp5.jpg","cbp6.jpg","cbp7.jpg","cbp1.jpg","cbp9.jpg","cbp10.jpg"];var design=["cbd6.jpg","cbd2.jpg","cbd3.jpg","cbd4.jpg","cbd5.jpg","cbd1.jpg","cbd7.jpg"];var illustration=["cbi1.jpg","cbi2.jpg","cbi3.jpg","cbi4.jpg","cbi5.jpg","cbi6.jpg","cbi7.jpg","cbi8.jpg","cbi9.jpg","cbi10.jpg","cbi11.jpg"];var maps={'art':function(){return workPage(art);},'illustration':function(){return workPage(illustration)},'design':function(){return workPage(design)},'photography':function(){return workPage(photos)},'index':function(){return frontPage();}};loadImage(imagepath+art[0]);loadImage(imagepath+photos[0]);loadImage(imagepath+design[0]);loadImage(imagepath+illustration[0]);function onPopState(e){backToPage(e.state.page);}
window.addEventListener('popstate',onPopState);var mypage;var mypath=window.location.pathname.split('/');if(!(mypath[mypath.length-1]in maps)){mypage='index';}else{mypage=mypath[mypath.length-1];}
toPage(mypage);function firstFadeIn(){var x=0;function futil(){document.body.style.opacity=x;if(x<1){x+=.03;requestAnimationFrame(futil);}}
requestAnimationFrame(futil);}
window.addEventListener('load',firstFadeIn);function touchUp(firstY,firstTime){return function(screenY){var dist=Math.abs(screenY-firstY);if(dist>height*.07&&dist/(Date.now()-firstTime)>.3){var evt=new CustomEvent('slide',{'detail':(screenY>firstY?'up':'down')});window.dispatchEvent(evt);}}}
function swipeDetector(e){var touches=e.changedTouches;for(var i=0;i<touches.length;i++){var touch=touches[i];var y=touch.screenY;var tme=Date.now();var id=touch.identifier;var onUp=touchUp(y,tme);function f(e){var newTouches=e.changedTouches;for(var j=0;j<newTouches.length;j++){if(newTouches[j].identifier===id){onUp(newTouches[j].screenY);document.removeEventListener('touchend',f);}}}
document.addEventListener('touchend',f);}}
function arrowDetector(e){if(e.keyCode===38||e.keyCode===40){var dir=(e.keyCode===38?'up':'down');var evt=new CustomEvent('slide',{'detail':dir});window.dispatchEvent(evt);}}
document.addEventListener('touchstart',swipeDetector);document.addEventListener('keydown',arrowDetector);var x=1;var mult=-1;function touchInstructions(){if(x>1){footerInstruct.style.opacity=1;}else if(x<0){mult=1;document.getElementById("instructiontext").innerHTML="Swipe up/down to browse";x=0;footerInstruct.style.opacity=0;requestAnimationFrame(touchInstructions);}else{x+=.02*mult;footerInstruct.style.opacity=x;requestAnimationFrame(touchInstructions);}}
oneTimeListener(document,'touchstart',touchInstructions);
